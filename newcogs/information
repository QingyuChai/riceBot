import discord
import datetime
import time

from discord.ext import commands

class Information:
    def __init__(self, bot):
        self.bot = bot

    @commands.command(pass_context=True, no_pm=True)
    async def serverinfo(self, ctx):
        """Shows server's informations"""
        server = ctx.message.server
        online = len([m.status for m in server.members
                      if m.status == discord.Status.online or
                      m.status == discord.Status.idle])
        total_users = len(server.members)
        text_channels = len([x for x in server.channels
                             if x.type == discord.ChannelType.text])
        voice_channels = len(server.channels) - text_channels
        passed = (ctx.message.timestamp - server.created_at).days

        title = server.name
        created_on = server.created_at.strftime("%d %b %Y %H:%M")
        color = 0x032449
        region = title(str(server.region))
        user_count = str(online + "/" + total_users)
        roles = len(server.roles)
        default_role = server.default_role

        embed=discord.Embed(title=title, description=server.id, color=color)

        embed.add_field(name="Region", value=region,)
        embed.add_field(name="Created On", value=created_on)

        embed.add_field(name="Text Channels", value=text_channels)
        embed.add_field(name="Voice Channels", value=voice_channels)

        embed.add_field(name="Roles", value=roles)
        embed.add_field(name="Default Role", value=default_role)

        embed.add_field(name="Usercount", value=user_count)
        embed.add_field(name="Owner", value=server.owner)


        embed.set_footer(text="riceBot")

        if server.icon_url:
            data.set_author(name=title, url=server.icon_url)
            data.set_thumbnail(url=server.icon_url)
        else:
            data.set_author(name=title)

        try:
            await self.bot.say(embed=embed)
        except discord.HTTPException:
            msg = ("Sorry! I don't have the **Embed Links** "
                   "permission! Please grant it to me!")
            await self.bot.say(msg)


def setup(bot):
    bot.remove_command('userinfo')
    bot.remove_command('serverinfo')
    bot.add_cog(Information(bot))
